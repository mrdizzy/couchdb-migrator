{"ts":1344589035125,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1344589075134,"patch":[[{"diffs":[[1,"var docs = require('./../../config/database').documents,\r\n    db = require('./../../config/database').db;\r\n\r\nvar resetDb = function(callback) {\r\n    db.destroy(function(error, response) {\r\n        if (error) {\r\n            callback(error, response);\r\n        }\r\n        else {\r\n            createDb(callback);\r\n        }\r\n    })\r\n}\r\n\r\nvar createDb = function(callback) {\r\n    db.create(function(err, res) {\r\n        if (err) {\r\n            callback(err, res);\r\n        }\r\n        else {\r\n            db.save(docs, function(err, res) {\r\n                if (err) {\r\n                    callback(err, res);\r\n                }\r\n                else {\r\n                    setUpSecurity(function(error, response) {\r\n                        if (error) {\r\n                            callback(error, response)\r\n                        }\r\n                        else {\r\n                            callback(error, response)\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n    })\r\n}\r\n// Defaults to admin only allowing access to database\r\n\r\nfunction setUpSecurity(callback) {\r\n    db.save(\"_security\", {\r\n        \"admins\": {\r\n            \"names\": [],\r\n            \"roles\": [\"admin\"]\r\n        },\r\n        \"members\": {\r\n            \"names\": [],\r\n            \"roles\": [\"admin\"]\r\n        }\r\n    }, callback)\r\n}\r\n\r\nmodule.exports.db = db;\r\nmodule.exports.createDb = createDb;\r\nmodule.exports.resetDb = resetDb;"]],"start1":0,"start2":0,"length1":0,"length2":1447}]],"length":1447,"saved":false}
{"contributors":[],"silentsave":false,"ts":1349389027205,"patch":[[{"diffs":[[0,",\r\n    d"],[-1,"b"],[1,"atabases"],[0," = requi"]],"start1":55,"start2":55,"length1":17,"length2":24},{"diffs":[[0,"tabase')"],[-1,".db"],[0,";\r\n\r\nvar"]],"start1":100,"start2":100,"length1":19,"length2":16},{"diffs":[[0,"etDb = function("],[1,"database_name, "],[0,"callback) {\r\n   "]],"start1":120,"start2":120,"length1":32,"length2":47},{"diffs":[[0,"{\r\n    d"],[-1,"b"],[1,"atabases[database_name]"],[0,".destroy"]],"start1":161,"start2":161,"length1":17,"length2":39},{"diffs":[[0,"unction("],[1,"database_name, "],[0,"callback"]],"start1":392,"start2":392,"length1":16,"length2":31},{"diffs":[[0,"{\r\n    d"],[-1,"b"],[1,"atabases[database_name]"],[0,".create("]],"start1":425,"start2":425,"length1":17,"length2":39},{"diffs":[[0,"           d"],[-1,"b"],[1,"atabases[database_name]"],[0,".save(docs, "]],"start1":567,"start2":567,"length1":25,"length2":47},{"diffs":[[0,"ecurity("],[-1,""],[0,""],[1,"database_name, "],[0,"function"]],"start1":774,"start2":774,"length1":16,"length2":31},{"diffs":[[0,"ecurity("],[1,"database_name,"],[0,"callback"]],"start1":1213,"start2":1213,"length1":16,"length2":30},{"diffs":[[0,"{\r\n    d"],[-1,"b"],[1,"atabases[database_name]"],[0,".save(\"_"]],"start1":1245,"start2":1245,"length1":17,"length2":39},{"diffs":[[0,"ts.d"],[-1,"b = db"],[1,"atabases = databases"],[0,";\r\nm"]],"start1":1515,"start2":1515,"length1":14,"length2":28}]],"length":1612,"saved":false}
{"contributors":[],"silentsave":false,"ts":1349395340903,"patch":[[{"diffs":[[0,"var "],[-1,"docs = require('./../../config/database').documents,\r\n    "],[0,"data"]],"start1":0,"start2":0,"length1":66,"length2":8},{"diffs":[[0,"ase');\r\n"],[-1,"\r\n"],[0,"var rese"]],"start1":45,"start2":45,"length1":18,"length2":16},{"diffs":[[0,"  if (error) {\r\n"],[1,"            if (error.error == \"not_found\") {\r\n                createDb(database_name, callback)\r\n            }\r\n            else {\r\n"],[0,"            call"]],"start1":176,"start2":176,"length1":32,"length2":165},{"diffs":[[0,"response);\r\n"],[1,"            }\r\n"],[0,"        }\r\n "]],"start1":353,"start2":353,"length1":24,"length2":39},{"diffs":[[0,"reateDb("],[1,"database_name, "],[0,"callback"]],"start1":420,"start2":420,"length1":16,"length2":31},{"diffs":[[0,"ve(d"],[-1,"oc"],[1,"atabases[database_name].document"],[0,"s, f"]],"start1":708,"start2":708,"length1":10,"length2":40}]],"length":1745,"saved":false}
{"contributors":[],"silentsave":false,"ts":1349824220867,"patch":[[{"diffs":[[0,"tabase')"],[-1,";\r"],[1,",\n    _ = require('underscore'),\n    async = require('async'),\n    fs = require('fs');\n"],[0,"\nvar res"]],"start1":42,"start2":42,"length1":18,"length2":103},{"diffs":[[0,"ame, callback) {"],[-1,"\r"],[0,"\n    databases[d"]],"start1":171,"start2":171,"length1":33,"length2":32},{"diffs":[[0,"ror, response) {"],[-1,"\r"],[0,"\n        if (err"]],"start1":236,"start2":236,"length1":33,"length2":32},{"diffs":[[0,"    if (error) {"],[-1,"\r"],[0,"\n            if "]],"start1":257,"start2":257,"length1":33,"length2":32},{"diffs":[[0,"ound\") {"],[-1,"\r"],[0,"\n       "]],"start1":311,"start2":311,"length1":17,"length2":16},{"diffs":[[0,"allback)"],[-1,"\r"],[0,"\n       "]],"start1":361,"start2":361,"length1":17,"length2":16},{"diffs":[[0,"k)\n            }"],[-1,"\r"],[0,"\n            els"]],"start1":367,"start2":367,"length1":33,"length2":32},{"diffs":[[0,"          else {"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"            call"]],"start1":386,"start2":386,"length1":34,"length2":37},{"diffs":[[0,"sponse);"],[-1,"\r"],[0,"\n       "]],"start1":437,"start2":437,"length1":17,"length2":16},{"diffs":[[0,");\n            }"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":443,"start2":443,"length1":33,"length2":32},{"diffs":[[0,"     }\n        }"],[-1,"\r"],[0,"\n        else {\r"]],"start1":453,"start2":453,"length1":33,"length2":32},{"diffs":[[0,"}\n        else {"],[-1,"\r"],[0,"\n            cre"]],"start1":468,"start2":468,"length1":33,"length2":32},{"diffs":[[0,"llback);"],[-1,"\r"],[0,"\n       "]],"start1":523,"start2":523,"length1":17,"length2":16},{"diffs":[[0,"   }"],[-1,"\r"],[0,"\n    })"],[-1,"\r"],[0,"\n}"],[-1,"\r\n\r"],[1,"\n"],[0,"\nvar"]],"start1":537,"start2":537,"length1":22,"length2":18},{"diffs":[[0,"ame, callback) {"],[-1,"\r"],[0,"\n    databases[d"]],"start1":586,"start2":586,"length1":33,"length2":32},{"diffs":[[0,"tion(err, res) {"],[-1,"\r"],[0,"\n        if (err"]],"start1":643,"start2":643,"length1":33,"length2":32},{"diffs":[[0,"      if (err) {"],[-1,"\r"],[0,"\n            cal"]],"start1":662,"start2":662,"length1":33,"length2":32},{"diffs":[[0,"lback(err, res);"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":694,"start2":694,"length1":33,"length2":32},{"diffs":[[0," res);\n        }"],[-1,"\r"],[0,"\n        else {\r"]],"start1":704,"start2":704,"length1":33,"length2":32},{"diffs":[[0,"}\n        else {"],[-1,"\r"],[0,"\n            dat"]],"start1":719,"start2":719,"length1":33,"length2":32},{"diffs":[[0,", res) {"],[-1,"\r"],[0,"\n       "]],"start1":826,"start2":826,"length1":17,"length2":16},{"diffs":[[0,"  if (err) {"],[-1,"\r"],[0,"\n           "]],"start1":849,"start2":849,"length1":25,"length2":24},{"diffs":[[0,"r, res);"],[-1,"\r"],[0,"\n       "]],"start1":893,"start2":893,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n               "]],"start1":903,"start2":903,"length1":33,"length2":32},{"diffs":[[0,"          else {"],[-1,"\r"],[0,"\n               "]],"start1":926,"start2":926,"length1":33,"length2":32},{"diffs":[[0,"ponse) {"],[-1,"\r"],[0,"\n       "]],"start1":1011,"start2":1011,"length1":17,"length2":16},{"diffs":[[0,"error) {"],[-1,"\r"],[0,"\n       "]],"start1":1048,"start2":1048,"length1":17,"length2":16},{"diffs":[[0,"error, response)"],[-1,"\r"],[0,"\n               "]],"start1":1094,"start2":1094,"length1":33,"length2":32},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n               "]],"start1":1120,"start2":1120,"length1":33,"length2":32},{"diffs":[[0,"  else {"],[-1,"\r"],[0,"\n       "]],"start1":1159,"start2":1159,"length1":17,"length2":16},{"diffs":[[0,"esponse)"],[-1,"\r"],[0,"\n       "]],"start1":1213,"start2":1213,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n               "]],"start1":1231,"start2":1231,"length1":33,"length2":32},{"diffs":[[0,"              })"],[-1,"\r"],[0,"\n               "]],"start1":1254,"start2":1254,"length1":33,"length2":32},{"diffs":[[0,"           }"],[-1,"\r"],[0,"\n           "]],"start1":1276,"start2":1276,"length1":25,"length2":24},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n       "]],"start1":1295,"start2":1295,"length1":17,"length2":16},{"diffs":[[0,"   }"],[-1,"\r"],[0,"\n    })"],[-1,"\r"],[0,"\n}"],[-1,"\r"],[0,"\n// "]],"start1":1309,"start2":1309,"length1":20,"length2":17},{"diffs":[[0,"database"],[-1,"\r\n\r\n"],[1,"\n\n    "],[0,"function"]],"start1":1368,"start2":1368,"length1":20,"length2":22},{"diffs":[[0,"se_name,"],[1," "],[0,"callback"]],"start1":1411,"start2":1411,"length1":16,"length2":17},{"diffs":[[0,"lback) {"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"    data"]],"start1":1423,"start2":1423,"length1":18,"length2":21},{"diffs":[[0,"rity\", {"],[-1,"\r"],[0,"\n"],[1,"   "],[0,"        "],[1," "],[0,"\"admins\""]],"start1":1476,"start2":1476,"length1":26,"length2":29},{"diffs":[[0," \"admins\": {"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"            "]],"start1":1496,"start2":1496,"length1":26,"length2":29},{"diffs":[[0,"    \"names\": [],"],[-1,"\r"],[0,"\n"],[1,"   "],[0,"            \"rol"]],"start1":1521,"start2":1521,"length1":34,"length2":36},{"diffs":[[0,"\n               "],[1," "],[0,"\"roles\": [\"admin"]],"start1":1537,"start2":1537,"length1":32,"length2":33},{"diffs":[[0,"in\"]"],[-1,"\r"],[0,"\n"],[1,"   "],[0,"        "],[1," "],[0,"},"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"        "],[1,"  "],[0,"\"mem"]],"start1":1568,"start2":1568,"length1":30,"length2":36},{"diffs":[[0,"bers\": {"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"        "]],"start1":1604,"start2":1604,"length1":18,"length2":21},{"diffs":[[0,"es\": [],"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":1633,"start2":1633,"length1":18,"length2":18},{"diffs":[[0,"],\n             "],[1,"   "],[0,"\"roles\": [\"admin"]],"start1":1639,"start2":1639,"length1":32,"length2":35},{"diffs":[[0,"in\"]"],[-1,"\r\n        }\r\n    }, callback)\r\n}\r\n\r\nmodule.exports.databases = databases;\r\nmodule.exports.createDb = createDb;\r"],[1,"\n            }\n        }, callback)\n    }\n\nvar cradle = require('cradle'),\n    connection = require('./connection'),\n\n\nvar db = new(cradle.Connection)(connection.host, 443, {\n    secure: true,\n    auth: {\n        username: \"casamiento\",\n        password: \"floppsy1\"\n    }\n}).database(\"test_ebay\");\n// DUMP \n\nvar dumpToJSON = function(database_name) {\n    var dump = [];\n\n    databases[database_name].all(function(err, res) {\n        var docs = _.map(res, function(doc) {\n            return (doc);\n        })\n        async.forEach(docs, function(doc, callback) {\n            databases[database_name].get(doc.id, function(err, res) {\n                delete res._rev\n                dump.push(res)\n                if (res._attachments) {\n                    handleAttachments(doc, res._attachments, function(err, collated) {\n                        res._attachments = collated;\n                        callback(err)\n                    })\n                }\n                else {\n                    callback(err)\n                }\n            })\n        }, function(err) {\n            fs.writeFile(\"results.json\", JSON.stringify(dump), function(err) {\n                if (err) {\n                    console.log(err);\n                }\n                else {\n                    console.log(\"The file was saved!\");\n                }\n            })\n        })\n    })\n\n    function handleAttachments(doc, attachments, cb) {\n        var collated = {}\n        async.forEach(Object.keys(attachments), function(filename, callback) {\n            var stream = databases[database_name].getAttachment(doc.id, filename)\n            var file = []\n            stream.on(\"data\", function(chunk) {\n                file.push(chunk)\n            })\n            stream.on(\"end\", function() {\n                var finished = Buffer.concat(file);\n                collated[filename] = {}\n                collated[filename][\"content_type\"] = attachments[filename][\"content_type\"]\n                collated[filename][\"data\"] = finished.toString('base64');\n                callback(null)\n            })\n        }, function(err) {\n            cb(err, collated)\n        })\n    }\n}\nmodule.exports.dumpToJSON = dumpToJSON;\nmodule.exports.databases = databases;\nmodule.exports.createDb = createDb;"],[0,"\nmod"]],"start1":1672,"start2":1672,"length1":119,"length2":2270}]],"length":3972,"saved":false}
{"ts":1349824234090,"patch":[[{"diffs":[[0," }\n\n"],[-1,"var cradle = require('cradle'),\n    connection = require('./connection'),\n\n\nvar db = new(cradle.Connection)(connection.host, 443, {\n    secure: true,\n    auth: {\n        username: \"casamiento\",\n        password: \"floppsy1\"\n    }\n}).database(\"test_ebay\");"],[0,"\n// "]],"start1":1715,"start2":1715,"length1":262,"length2":8}]],"length":3718,"saved":false}
{"ts":1349824240777,"patch":[[{"diffs":[[0,"\n    }\n\n"],[-1,"\n"],[0,"// DUMP "]],"start1":1711,"start2":1711,"length1":17,"length2":16}]],"length":3717,"saved":false}
{"ts":1349824275383,"patch":[[{"diffs":[[0,"\n    }\n}"],[1,"\n\ndumpToJSON(\"ebay_messages\");"],[0,"\nmodule."]],"start1":3561,"start2":3561,"length1":16,"length2":46}]],"length":3747,"saved":false}
{"ts":1349824536276,"patch":[[{"diffs":[[0,"\n}\n\n"],[-1,"dumpToJSON(\"ebay_messages\")"],[1,"\nvar importFromJSON = function(database_name) {\nfs.readFile('results.json', 'utf-8', function(err, res) {\n    var doc = JSON.parse(res)\n    databases[database_name].save(doc, function(e, r) {\n        console.log(e, r)\n    })\n})\n}\n\ndumpToJSON(\"ebay_messages\");\nmodule.exports.importFromJSON"],[0,";\nmo"]],"start1":3567,"start2":3567,"length1":35,"length2":297}]],"length":4009,"saved":false}
{"ts":1349825057236,"patch":[[{"diffs":[[0,"re('fs')"],[-1,""],[0,""],[1,",\n    bufferjs = require('bufferjs')"],[0,";\n\nvar r"]],"start1":127,"start2":127,"length1":16,"length2":52},{"diffs":[[0,"\n    }\n\n"],[-1,""],[0,""],[1,"    "],[0,"// DUMP "]],"start1":1747,"start2":1747,"length1":16,"length2":20},{"diffs":[[0,"   }\n}\n\n"],[-1,"\n"],[0,"var impo"]],"start1":3603,"start2":3603,"length1":17,"length2":16},{"diffs":[[0,"name) {\n"],[1,"    "],[0,"fs.readF"]],"start1":3650,"start2":3650,"length1":16,"length2":20},{"diffs":[[0," res) {\n    "],[1,"   "],[1," "],[0,"var doc = JS"]],"start1":3712,"start2":3712,"length1":24,"length2":28},{"diffs":[[0,".parse(res)\n"],[1,"    "],[0,"    database"]],"start1":3742,"start2":3742,"length1":24,"length2":28},{"diffs":[[0,"e, r) {\n        "],[1,"  "],[1,"  "],[0,"console.log(e, r"]],"start1":3806,"start2":3806,"length1":32,"length2":36},{"diffs":[[0,"    "],[-1,"})\n})\n}\n\ndumpToJSON(\"ebay_messages\");"],[1,"    })\n    })\n}\n"],[0,"\nmod"]],"start1":3844,"start2":3844,"length1":45,"length2":24}]],"length":4043,"saved":false}
